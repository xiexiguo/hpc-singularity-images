Bootstrap: localimage
From: /public/singularity/images/ubuntu/intel-runtime.img

%labels
    intelmpi 2017 development, including compiler, libraries and head files.

%files
    impi-2017-runtime.tgz /opt

%post
    apt install -y libdapl2 libdapl-dev dapl2-utils
    cd /opt && tar xf impi-2017-runtime.tgz
    rm -f impi-2017-runtime.tgz
    mkdir -p /public/home
    mkdir -p /public/sourcecode
    mkdir -p /public/software

%runscript
    /bin/bash

%test
    echo $LD_LIBRARY_PATH

%environment
    export CP_INTELMPI_DIR=/opt/impi-2017-runtime
    export LIBRARY_PATH=${CP_INTELMPI_DIR}/lib64:$LIBRARY_PATH
    export LD_LIBRARY_PATH=${CP_INTELMPI_DIR}/lib64:$LD_LIBRARY_PATH
